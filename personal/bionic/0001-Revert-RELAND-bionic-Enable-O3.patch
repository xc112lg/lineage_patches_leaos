From efeab06808962f27ca3a0343ba1bf95be8b2ae69 Mon Sep 17 00:00:00 2001
From: Victor Bo <bvoid@yandex.ru>
Date: Mon, 31 Jan 2022 17:25:17 +0000
Subject: [PATCH 1/2] Revert "RELAND: bionic: Enable -O3"

This reverts commit 4114593175e1bc96925be734a80551c6c1502379.
---
 benchmarks/Android.bp | 3 +--
 libc/Android.bp       | 2 --
 libdl/Android.bp      | 2 --
 libm/Android.bp       | 1 -
 linker/Android.bp     | 3 ---
 5 files changed, 1 insertion(+), 10 deletions(-)

diff --git a/benchmarks/Android.bp b/benchmarks/Android.bp
index 0c43522c5..5f8c11306 100644
--- a/benchmarks/Android.bp
+++ b/benchmarks/Android.bp
@@ -17,7 +17,7 @@
 cc_defaults {
     name: "bionic-benchmarks-defaults",
     cflags: [
-        "-O3",
+        "-O2",
         "-fno-builtin",
         "-Wall",
         "-Wextra",
@@ -71,7 +71,6 @@ cc_defaults {
         "-Wextra",
         "-Werror",
         "-Wunused",
-        "-O3",
     ],
 }
 
diff --git a/libc/Android.bp b/libc/Android.bp
index f80f5ae2f..878ec7c62 100644
--- a/libc/Android.bp
+++ b/libc/Android.bp
@@ -36,7 +36,6 @@ libc_common_flags = [
     "-Wno-deprecated-declarations",
     "-Wno-gcc-compat",
     "-Wframe-larger-than=2048",
-    "-O3",
 
     // Try to catch typical 32-bit assumptions that break with 64-bit pointers.
     "-Werror=pointer-to-int-cast",
@@ -1992,7 +1991,6 @@ cc_defaults {
         "-Wno-gcc-compat",
         "-Wall",
         "-Werror",
-        "-O3",
     ],
     sanitize: {
         never: true,
diff --git a/libdl/Android.bp b/libdl/Android.bp
index 823993a21..bb9fc593a 100644
--- a/libdl/Android.bp
+++ b/libdl/Android.bp
@@ -18,7 +18,6 @@ cc_library_static {
         "-Wextra",
         "-Wunused",
         "-Werror",
-        "-O3",
     ],
 
     // For private/CFIShadow.h.
@@ -176,7 +175,6 @@ cc_library {
         "-Wextra",
         "-Wunused",
         "-Werror",
-        "-O3",
     ],
 
     stl: "none",
diff --git a/libm/Android.bp b/libm/Android.bp
index 007ea6fe5..77579d260 100644
--- a/libm/Android.bp
+++ b/libm/Android.bp
@@ -510,7 +510,6 @@ cc_library {
         "-Wno-unknown-pragmas",
         "-Wno-unused-const-variable",
         "-Wno-unused-variable",
-        "-O3",
         "-ffp-contract=fast",
     ],
 
diff --git a/linker/Android.bp b/linker/Android.bp
index 97b1f74a0..d2eb07e09 100644
--- a/linker/Android.bp
+++ b/linker/Android.bp
@@ -33,7 +33,6 @@ cc_object {
         "-Wextra",
         "-Wno-unused",
         "-Werror",
-        "-O3",
     ],
 
     srcs: [
@@ -81,7 +80,6 @@ cc_defaults {
         "-Wextra",
         "-Wunused",
         "-Werror",
-        "-O3",
     ],
 
     // TODO: split out the asflags.
@@ -433,7 +431,6 @@ cc_library {
         "-Wextra",
         "-Wunused",
         "-Werror",
-        "-O3",
     ],
     stl: "none",
 
-- 
2.25.1

