From 42700e4f6e1891272ff46b6185ec759116f734da Mon Sep 17 00:00:00 2001
From: Victor Bo <bvoid@yandex.ru>
Date: Wed, 24 Mar 2021 08:24:45 -0400
Subject: [PATCH 2/5] surfaceflinger: switch to -O3

---
 libs/nativedisplay/Android.bp      | 1 +
 services/surfaceflinger/Android.bp | 6 ++++++
 2 files changed, 7 insertions(+)

diff --git a/libs/nativedisplay/Android.bp b/libs/nativedisplay/Android.bp
index f56b3a217..38494e544 100644
--- a/libs/nativedisplay/Android.bp
+++ b/libs/nativedisplay/Android.bp
@@ -27,6 +27,7 @@ cc_library_shared {
     clang: true,
 
     cflags: [
+        "-O3",
         "-Wall",
         "-Werror",
         "-Wno-enum-compare",
diff --git a/services/surfaceflinger/Android.bp b/services/surfaceflinger/Android.bp
index 4b56f8f5b..a2128d0a7 100644
--- a/services/surfaceflinger/Android.bp
+++ b/services/surfaceflinger/Android.bp
@@ -1,6 +1,7 @@
 cc_defaults {
     name: "surfaceflinger_defaults",
     cflags: [
+        "-O3",
         "-Wall",
         "-Werror",
         "-Wformat",
@@ -21,6 +22,7 @@ cc_defaults {
         "surfaceflinger_qcom_ext_defaults",
     ],
     cflags: [
+        "-O3",
         "-DLOG_TAG=\"SurfaceFlinger\"",
         "-DGL_GLEXT_PROTOTYPES",
         "-DEGL_EGLEXT_PROTOTYPES",
@@ -114,6 +116,7 @@ cc_defaults {
     name: "libsurfaceflinger_production_defaults",
     defaults: ["libsurfaceflinger_defaults"],
     cflags: [
+        "-O3",
         "-fvisibility=hidden",
         "-fwhole-program-vtables", // requires ThinLTO
     ],
@@ -206,12 +209,14 @@ cc_library_shared {
         "SurfaceFlingerFactory.cpp",
     ],
     cflags: [
+        "-O3",
         "-DUSE_VR_COMPOSER=1",
     ],
     // VrComposer is not used when building surfaceflinger for vendors
     target: {
         vendor: {
             cflags: [
+                "-O3",
                 "-DUSE_VR_COMPOSER=0",
             ],
         },
@@ -223,6 +228,7 @@ cc_defaults {
     name: "libsurfaceflinger_binary",
     defaults: ["surfaceflinger_defaults"],
     cflags: [
+        "-O3",
         "-DLOG_TAG=\"SurfaceFlinger\"",
     ],
     shared_libs: [
-- 
2.25.1

